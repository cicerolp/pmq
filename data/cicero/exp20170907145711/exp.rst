=================
Benchmark Queries
=================

    :Author: julio

1 Description
-------------

**DISCLAIMER:** This bencmark used an ineficient (and unstable) algorithm from Boost for dealing with spacial coordinates. 

Test the queries on uniform data. 
And compare the folling performances.

Use 10\*\*8 elements. 

- PMQ / GEOHASH

- BTREE

- RTREE - quadratic algorithm

- RTREE - quadratic algorithm with bulk loading

Use the refinement level = 8 

2 Analisys
----------

2.1 Results
~~~~~~~~~~~

2.1.1 Plot overview
^^^^^^^^^^^^^^^^^^^

.. image:: ./img/overview_query_region.png

2.1.2 Conclusions
^^^^^^^^^^^^^^^^^

- PMQ shows its best benefits on large range queries

- for very small queries we are similar to othe Btree an Rtree

- Bulk loading on Rtree only work on static case. The partitionning is optimized when all the queries are loaded together.

2.2 What is the actual count of elements per query ?
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

2.2.1 Table
^^^^^^^^^^^

Variance shows that some counts differ between algorithms:

.. table::

    +---------+--------------+----------------------+------------------+--------------+-------+
    | queryId | BTree\_Count | GeoHashBinary\_Count | RTreeBulk\_Count | RTree\_Count |   Var |
    +=========+==============+======================+==================+==============+=======+
    |       0 |     13239675 |             13239675 |         13239675 |     13239675 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       1 |     13238671 |             13238671 |         13238674 |     13238672 |     2 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       2 |     13232631 |             13232631 |         13232632 |     13232632 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       3 |     13236197 |             13236197 |         13236199 |     13236199 | 1.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       4 |     13235039 |             13235039 |         13235039 |     13235039 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       5 |     13234142 |             13234142 |         13234143 |     13234143 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       6 |     13236459 |             13236459 |         13236459 |     13236456 |  2.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       7 |     13237088 |             13237088 |         13237091 |     13237091 |     3 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       8 |     13237620 |             13237620 |         13237620 |     13237617 |  2.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       9 |     13236585 |             13236585 |         13236585 |     13236585 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      10 |      3307999 |              3307999 |          3307999 |      3307999 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      11 |      3307714 |              3307714 |          3307716 |      3307716 | 1.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      12 |      3311742 |              3311742 |          3311742 |      3311742 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      13 |      3309493 |              3309493 |          3309493 |      3309493 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      14 |      3311510 |              3311510 |          3311512 |      3311512 | 1.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      15 |      3307750 |              3307750 |          3307751 |      3307749 | 0.667 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      16 |      3306478 |              3306478 |          3306479 |      3306480 | 0.917 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      17 |      3310550 |              3310550 |          3310550 |      3310550 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      18 |      3308792 |              3308792 |          3308792 |      3308792 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      19 |      3306174 |              3306174 |          3306174 |      3306174 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      20 |       827282 |               827282 |           827283 |       827283 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      21 |       826201 |               826201 |           826201 |       826201 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      22 |       827822 |               827822 |           827822 |       827822 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      23 |       826550 |               826550 |           826550 |       826549 |  0.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      24 |       827529 |               827529 |           827529 |       827529 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      25 |       827031 |               827031 |           827031 |       827031 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      26 |       826961 |               826961 |           826961 |       826960 |  0.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      27 |       826865 |               826865 |           826866 |       826866 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      28 |       827114 |               827114 |           827114 |       827114 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      29 |       827674 |               827674 |           827674 |       827674 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      30 |       206006 |               206006 |           206006 |       206005 |  0.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      31 |       207318 |               207318 |           207318 |       207318 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      32 |       206660 |               206660 |           206660 |       206660 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      33 |       206557 |               206557 |           206558 |       206558 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      34 |       206389 |               206389 |           206389 |       206389 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      35 |       207421 |               207421 |           207421 |       207421 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      36 |       207564 |               207564 |           207564 |       207564 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      37 |       207137 |               207137 |           207137 |       207137 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      38 |       206811 |               206811 |           206811 |       206811 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      39 |       206995 |               206995 |           206995 |       206995 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      40 |        51787 |                51787 |            51787 |        51787 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      41 |        51758 |                51758 |            51759 |        51759 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      42 |        51959 |                51959 |            51960 |        51960 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      43 |        51525 |                51525 |            51525 |        51525 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      44 |        51759 |                51759 |            51759 |        51759 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      45 |        51614 |                51614 |            51614 |        51614 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      46 |        52054 |                52054 |            52054 |        52054 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      47 |        51658 |                51658 |            51658 |        51658 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      48 |        52017 |                52017 |            52017 |        52017 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      49 |        51573 |                51573 |            51573 |        51573 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      50 |        12944 |                12944 |            12944 |        12944 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      51 |        12679 |                12679 |            12679 |        12679 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      52 |        13078 |                13078 |            13078 |        13078 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      53 |        12915 |                12915 |            12915 |        12915 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      54 |        12945 |                12945 |            12945 |        12945 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      55 |        12978 |                12978 |            12978 |        12978 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      56 |        12961 |                12961 |            12962 |        12962 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      57 |        12816 |                12816 |            12816 |        12816 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      58 |        13050 |                13050 |            13050 |        13050 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      59 |        12981 |                12981 |            12981 |        12981 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      60 |         3185 |                 3185 |             3185 |         3185 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      61 |         3229 |                 3229 |             3229 |         3229 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      62 |         3203 |                 3203 |             3203 |         3203 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      63 |         3303 |                 3303 |             3303 |         3303 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      64 |         3227 |                 3227 |             3227 |         3227 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      65 |         3276 |                 3276 |             3276 |         3276 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      66 |         3181 |                 3181 |             3181 |         3181 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      67 |         3238 |                 3238 |             3238 |         3238 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      68 |         3173 |                 3173 |             3173 |         3173 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      69 |         3214 |                 3214 |             3214 |         3214 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      70 |          840 |                  840 |              840 |          840 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      71 |          859 |                  859 |              859 |          859 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      72 |          855 |                  855 |              855 |          855 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      73 |          795 |                  795 |              795 |          795 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      74 |          802 |                  802 |              802 |          802 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      75 |          816 |                  816 |              816 |          816 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      76 |          832 |                  832 |              832 |          832 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      77 |          762 |                  762 |              762 |          762 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      78 |          841 |                  841 |              841 |          841 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      79 |          795 |                  795 |              795 |          795 |     0 |
    +---------+--------------+----------------------+------------------+--------------+-------+



Just the diverging queries : 

.. table:: Queries that returned different result depending on the algorithm

    +---------+--------------+----------------------+------------------+--------------+-------+
    | queryId | BTree\_Count | GeoHashBinary\_Count | RTreeBulk\_Count | RTree\_Count |   Var |
    +=========+==============+======================+==================+==============+=======+
    |       1 |     13238671 |             13238671 |         13238674 |     13238672 |     2 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       2 |     13232631 |             13232631 |         13232632 |     13232632 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       3 |     13236197 |             13236197 |         13236199 |     13236199 | 1.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       5 |     13234142 |             13234142 |         13234143 |     13234143 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       6 |     13236459 |             13236459 |         13236459 |     13236456 |  2.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       7 |     13237088 |             13237088 |         13237091 |     13237091 |     3 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |       8 |     13237620 |             13237620 |         13237620 |     13237617 |  2.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      11 |      3307714 |              3307714 |          3307716 |      3307716 | 1.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      14 |      3311510 |              3311510 |          3311512 |      3311512 | 1.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      15 |      3307750 |              3307750 |          3307751 |      3307749 | 0.667 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      16 |      3306478 |              3306478 |          3306479 |      3306480 | 0.917 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      20 |       827282 |               827282 |           827283 |       827283 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      23 |       826550 |               826550 |           826550 |       826549 |  0.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      26 |       826961 |               826961 |           826961 |       826960 |  0.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      27 |       826865 |               826865 |           826866 |       826866 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      30 |       206006 |               206006 |           206006 |       206005 |  0.25 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      33 |       206557 |               206557 |           206558 |       206558 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      41 |        51758 |                51758 |            51759 |        51759 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      42 |        51959 |                51959 |            51960 |        51960 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+
    |      56 |        12961 |                12961 |            12962 |        12962 | 0.333 |
    +---------+--------------+----------------------+------------------+--------------+-------+

2.2.2 Plot
^^^^^^^^^^

There are some queries where the count differs for Rtree by a small amount of elements.

Counts have some differences :
These are the queries that for some misterious reason resulted in different counts.

.. image:: ./img/differing_counts.png
